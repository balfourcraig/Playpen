<!DOCTYPE html>
<html lang="en-nz">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<title>Nail Board - Craig's Playpen</title>
	<link rel="stylesheet" href="../css/styles.css">
	<script src="../scripts/utils.js"></script>
	<script>
		let animationID = null;
		
		function setUpBlankCanvas(){
			const c = document.createElement('canvas');
			const w = document.getElementById('sizeCalc').getBoundingClientRect().width;
			c.setAttribute('width', w);
			c.setAttribute('height', w);
			const ctx = c.getContext('2d');
			
			const canvResult = document.getElementById('canvResult');
			canvResult.innerHTML = '';
			canvResult.appendChild(c);
			
			ctx.fillStyle = '#eee';
			ctx.fillRect(0, 0, w, w);
		}

		function drawPattern(){
			document.getElementById('drawBtn').setAttribute('style','display:none');
			document.getElementById('stopDrawingBtn').removeAttribute('style');
			
			window.cancelAnimationFrame(animationID);
			const c = document.createElement('canvas');
			const w = document.getElementById('sizeCalc').getBoundingClientRect().width;
			c.setAttribute('width', w);
			c.setAttribute('height', w);
			const ctx = c.getContext('2d');
			
			ctx.lineWidth = 1;
			const center = {x: w/2.0, y: w/2.0};
			const radius = w * 0.45;

			const canvResult = document.getElementById('canvResult');
			canvResult.innerHTML = '';
			canvResult.appendChild(c);
			
			ctx.fillStyle = 'white';
			ctx.strokeStyle = 'black';
			ctx.fillRect(0, 0, w, w);
			ctx.globalAlpha = 0.7;
			
			//ctx.globalCompositeOperation = 'multiply';
			
			const points = parseInt(document.getElementById('numNails').value);

			const color = randomColor();

			const animate = document.getElementById('animateInput').checked;
			
			const colorMode = document.getElementById('colorModeSelect').value;
			const useColor = colorMode === 'mono' || colorMode === 'wheel' || colorMode === 'random';
			const useGradient = colorMode === 'wheel';
			
			const drawings = [];
			
			for(let i = 0; i < points; i++){
				const pointFrom = pointOnCircle(center, radius, points, i % points);
				for(let j = i + 1; j < points ; j++){
					const pointTo = pointOnCircle(center, radius, points, j % points);
					drawings.push(() => {
						if(useColor){
							const grad = ctx.createLinearGradient(pointFrom.x, pointFrom.y, pointTo.x, pointTo.y);
							if(colorMode === 'wheel'){
								const iFrom = ((i % points)/points) * 720;
								const iTo = ((j % points)/points) * 720;
								//grad.addColorStop(0, 'transparent');
								grad.addColorStop(0, 'hsl(' + iFrom + ', 80%, 50%)');
								grad.addColorStop(1, 'hsl(' + iTo + ', 80%, 50%)');
								//grad.addColorStop(1, 'transparent');
							}
							else if(colorMode === 'random'){
								const col1 = randomColor();
								const col2 = randomColor();
								grad.addColorStop(0, 'transparent');
								grad.addColorStop(0.1, col1);
								grad.addColorStop(0.9, col2);
								grad.addColorStop(1, 'transparent');
							}
							else{
								grad.addColorStop(0, 'transparent');
								grad.addColorStop(0.1, color);
								grad.addColorStop(0.9, color);
								grad.addColorStop(1, 'transparent');
							}
							ctx.strokeStyle = grad;
						}
					
						ctx.beginPath();
						ctx.moveTo(pointFrom.x, pointFrom.y);
						ctx.lineTo(pointTo.x, pointTo.y);
						ctx.stroke();
					});
				}
			}
				
			if(animate){
				const drawLine = (i) => {
					if(i < drawings.length){
						drawings[i]();
						i++;
						animationID = window.requestAnimationFrame(() =>{
							drawLine(i);
						});
					}
					else{
						document.getElementById('drawBtn').removeAttribute('style');
						document.getElementById('stopDrawingBtn').setAttribute('style','display:none');
					}
				}
				animationID = window.requestAnimationFrame(() =>{
					drawLine(0);
				});
			}
			else{
				for(let i = 0; i < drawings.length; i++){
					drawings[i]();
				}
				document.getElementById('drawBtn').removeAttribute('style');
				document.getElementById('stopDrawingBtn').setAttribute('style','display:none');
			}
			
		}
		
		function randomiseValues(){
			document.getElementById('numNails').value = Math.floor(Math.random() * 90 + 5);
		}

		window.addEventListener('DOMContentLoaded', () => {
			document.getElementById('drawBtn').addEventListener('click', drawPattern);
			document.getElementById('stopDrawingBtn').addEventListener('click', () => {
				cancelAnimationFrame(animationID);
				document.getElementById('stopDrawingBtn').setAttribute('style','display:none');
				document.getElementById('drawBtn').removeAttribute('style');
			});
			document.getElementById('luckBtn').addEventListener('click', () => {
				randomiseValues();
				drawPattern();
			});

			setUpBlankCanvas();
		});
	</script>
	<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico" />
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160042243-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-160042243-1');
	</script>
</head>
<body>
<div class="navHolder">
	<nav>
		<a href="../index.html">Home</a>
		<a class="selected" href="../ramblings.html">Deranged Ramblings</a>
		<a href="../about.html">About</a>
	</nav>
</div>
<main>
	<div class="pageWidth">
		<header>
			<h1>Nail Board</h1>
		</header>
		<section>
			
			<div class="optionsArea">
				<div class="op">
					<button id="drawBtn">Draw!</button>
					<button id="stopDrawingBtn" style="display:none">STOP</button>
					<br>
					<button id="luckBtn">I'm feeling lucky!</button>
				</div>
			</div>
			
			<div id="sizeCalc"></div>
			<div id="canvResult"></div>

			<div class="optionsArea">
				<div class="op">
					<input id="animateInput" type="checkbox" checked>
					<label for="animateInput">Animate</label>
				</div>
				<div class="op">
					<input id="numNails" type="number" min="3" value="30">
					<label for="numNails">Modulus</label>
				</div>
				<div class="op">
					<select id="colorModeSelect">
						<option value="black">Black</option>
						<option value="mono">Monochrome</option>
						<option value="wheel" selected>Wheel</option>
						<option value="random">Random</option>
					</select>
					<label for="colorModeSelect">Color Mode</label>
				</div>
			</div>
		</section>
		<div class="scrollOverflow"></div>
	</div>
</main>
</body>
</html>