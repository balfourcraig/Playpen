<!DOCTYPE html>
<html lang="en-nz">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<title>Pendulum - Craig's Playpen</title>
	<link rel="stylesheet" href="../css/styles.css">
	<script src="../scripts/utils.js"></script>
	<script>
		let animationID = null;
		let init = {};
		
		
		
		
	
		function drawPattern(){
			document.getElementById('drawBtn').setAttribute('style','display:none');
			document.getElementById('stopDrawingBtn').removeAttribute('style');
			
			window.cancelAnimationFrame(animationID);
			const c = document.createElement('canvas');
			const w = document.getElementById('sizeCalc').getBoundingClientRect().width;
			console.log(w);
			c.setAttribute('width', w);
			c.setAttribute('height', w);
			const ctx = c.getContext('2d');
			ctx.lineWidth = 1;
			//ctx.lineCap = "round";
			const center = {x: w/2.0, y: w/2.0};
			const radius = w * 0.3;
			
			const canvResult = document.getElementById('canvResult');
			canvResult.innerHTML = '';
			canvResult.appendChild(c);
			
			ctx.globalAlpha = 1;
			ctx.fillStyle = 'white';
			ctx.fillRect(0, 0, w, w);

			var g      = 9.8;
			var time   = 0.05;

			clearInterval(init);
			
			const pend01 = {
				d2Theta1 : 0,
				d2Theta2 : 0,
				dTheta1  : 0,
				dTheta2  : 0,
				Theta1   : 0.1*(Math.PI)/2,
				Theta2   : 2.2*(Math.PI)/2,
				m1     : 10,
				m2     : 10,
				l1     : w * 0.25,
				l2     : w * 0.25,
				X0     : center.x,
				Y0     : center.y,
				prevPoint: null,
				color: 'red',
			};
			
			const pendula = [pend01];
			const diff = 0.9;
			ctx.globalAlpha = 0.3;
			
			const numPens = 50;
			
			const m1Diff = pend01.m1 * diff;
			const m2Diff = pend01.m2 * diff;
			
			for(let i = 0; i < numPens; i++){
				const pen = {
					d2Theta1 : pend01.d2Theta1,
					d2Theta2 : pend01.d2Theta2,
					dTheta1  : pend01.dTheta1,
					dTheta2  : pend01.dTheta2,
					Theta1   : pend01.Theta1,
					Theta2   : pend01.Theta2,
					m1     : pend01.m1,
					m2     : pend01.m2 - m2Diff + ((m2Diff / numPens) * i),
					l1     : pend01.l1,
					l2     : pend01.l2,
					X0     : pend01.X0,
					Y0     : pend01.Y0,
					prevPoint: null,
					color: 'hsl(' + (i * (360/numPens)) + ', 80%, 50%)',
				};
				pendula.push(pen);
			}

			init = setInterval(function(){
				//ctx.globalAlpha = 0.01;
				//ctx.fillStyle = 'white';
				//ctx.fillRect(0, 0, w, w);
				//ctx.globalAlpha = 0.3;
				
				for(let i = 0; i < pendula.length; i++){
					animate(pendula[i], i > 0 ? pendula[i-1].prevPoint : null);
				}
			}, 1);
			
			function animate(pen, prevPoint) {
				const mu      =  1+pen.m1/pen.m2;
				pen.d2Theta1  =  (g*(Math.sin(pen.Theta2)*Math.cos(pen.Theta1-pen.Theta2)-mu*Math.sin(pen.Theta1))-(pen.l2*pen.dTheta2*pen.dTheta2+pen.l1*pen.dTheta1*pen.dTheta1*Math.cos(pen.Theta1-pen.Theta2))*Math.sin(pen.Theta1-pen.Theta2))/(pen.l1*(mu-Math.cos(pen.Theta1-pen.Theta2)*Math.cos(pen.Theta1-pen.Theta2)));
				pen.d2Theta2  =  (mu*g*(Math.sin(pen.Theta1)*Math.cos(pen.Theta1-pen.Theta2)-Math.sin(pen.Theta2))+(mu*pen.l1*pen.dTheta1*pen.dTheta1+pen.l2*pen.dTheta2*pen.dTheta2*Math.cos(pen.Theta1-pen.Theta2))*Math.sin(pen.Theta1-pen.Theta2))/(pen.l2*(mu-Math.cos(pen.Theta1-pen.Theta2)*Math.cos(pen.Theta1-pen.Theta2)));
				pen.dTheta1   += pen.d2Theta1*time;
				pen.dTheta2   += pen.d2Theta2*time;
				pen.Theta1    += pen.dTheta1*time;
				pen.Theta2    += pen.dTheta2*time;
				
				const x = pen.X0+pen.l1*Math.sin(pen.Theta1)+pen.l2*Math.sin(pen.Theta2);
				const y = pen.Y0+pen.l1*Math.cos(pen.Theta1)+pen.l2*Math.cos(pen.Theta2);
				
				const point = {x:x, y:y};
				if(pen.prevPoint){
					drawLineFlat(ctx, pen.prevPoint, point, pen.color);
				}
				pen.prevPoint = point;			
			}
		}

		function drawCircle(myCircle, context) {
			context.beginPath();
			context.arc(myCircle.x, myCircle.y, myCircle.mass, 0, 2 * Math.PI, false);
			context.fillStyle = '#000';
			context.fill();
			context.lineWidth = 5;
			context.strokeStyle = 'black';
			context.stroke();
		}

		function drawLine(myLine, context) {
			context.beginPath();
			context.moveTo(myLine.x0, myLine.y0);
			context.lineTo(myLine.x, myLine.y);
			context.strokeStyle = 'red';
			context.stroke();
		}

		function drawLineFlat(ctx, start, end, color){
			ctx.strokeStyle = color;
			ctx.beginPath();
			ctx.moveTo(start.x, start.y);
			ctx.lineTo(end.x,end.y);
			ctx.stroke();
		}
		
		//function drawCircle(ctx, center, radius, color){
			//ctx.strokeStyle = color;
			//ctx.beginPath();
			//ctx.arc(center.x, center.y, radius, 0, 2 * Math.PI);
			//ctx.stroke();
		//}
		
		window.addEventListener('DOMContentLoaded', () => {
			document.getElementById('drawBtn').addEventListener('click', drawPattern);
			document.getElementById('stopDrawingBtn').addEventListener('click', () => {
				cancelAnimationFrame(animationID);
				clearInterval(init);
				document.getElementById('stopDrawingBtn').setAttribute('style','display:none');
				document.getElementById('drawBtn').removeAttribute('style');
			});
		});
	</script>
	<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico" />
	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=UA-160042243-1"></script>
	<script>
	  window.dataLayer = window.dataLayer || [];
	  function gtag(){dataLayer.push(arguments);}
	  gtag('js', new Date());

	  gtag('config', 'UA-160042243-1');
	</script>
</head>
<body>
<div class="navHolder">
	<nav>
		<a href="../index.html">Home</a>
		<a class="selected" href="../ramblings.html">Deranged Ramblings</a>
		<a href="../about.html">About</a>
	</nav>
</div>

<main>
	<div class="pageWidth">
		<header>
			<h1>Pendulum</h1>
		</header>
		<section>
			<button id="drawBtn">Draw!</button>
			<button id="stopDrawingBtn" style="display:none">STOP</button>

			<div id="sizeCalc"></div>
			<img id="modMulResult">
			<div id="canvResult"></div>
		</section>
		<div class="scrollOverflow"></div>
	</div>
</main>
</body>
</html>