<!DOCTYPE html>
<html lang="en-nz">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<title>Gauss - Craig's Playpen</title>
	<link rel="stylesheet" href="../css/styles.css">
	<script>
		function randomColor() {
			const lightness = 255;
			const arr = [];
			arr[0] = Math.floor(Math.random() * lightness);
			arr[1] = Math.floor(Math.random() * (lightness - arr[0]));
			arr[2] = Math.floor(Math.random() * (lightness - arr[1] - arr[0]));
			shuffleInplace(arr);
			
			let color = '#';
			for(let i = 0; i < 3; i++){
				if(arr[i] >= 16){
					color += arr[i].toString(16);
				}
				else{
					color += '0' + arr[i].toString(16);
				}
			}
			return color;
			
			//var letters = '0123456789ABC';
			//var color = '#';
			//for (var i = 0; i < 6; i++) {
			//color += letters[Math.floor(Math.random() * letters.length)];
			//}
			//return color;
		}
		
		function shuffleInplace(arr){
			let n = arr.length;
			while(n > 0){
				const r = Math.floor(Math.random() * n);
				const temp = arr[r];
				arr[r] = arr[n-1];
				arr[n-1] = temp;
				n--;
			}
		}
		
		const goldenAngleRad = 2.39996322972865332;
		let animationID = null;

		function drawPattern(){
			document.getElementById('drawBtn').setAttribute('style','display:none');
			document.getElementById('stopDrawingBtn').removeAttribute('style');
			
			window.cancelAnimationFrame(animationID);
			const c = document.createElement('canvas');
			const w = document.getElementById('sizeCalc').getBoundingClientRect().width;
			c.setAttribute('width', w);
			c.setAttribute('height', w);
			const ctx = c.getContext('2d');
			const center = {x: w/2.0, y: w/2.0};
			
			
			const canvResult = document.getElementById('canvResult');
			canvResult.innerHTML = '';
			canvResult.appendChild(c);
			
			ctx.fillStyle = 'black';
			ctx.strokeStyle = 'none';
			ctx.beginPath();
			ctx.rect(0, 0, w, w);
			ctx.fill();
			ctx.globalAlpha = 0.2;

			ctx.globalCompositeOperation = 'screen';
			
			const animate = document.getElementById('animateInput').checked;
			const useColor = document.getElementById('colorInput').checked;
			const useGradient = document.getElementById('gradInput').checked;
			
			const drawings = [];
			
			for(let i = 0; i < 900; i++){
				const radius = Math.random() * 0.01 + 0.01;
				drawings.push(() => drawCircle(ctx, gaussianPoint(center.x, center.x/3), w*radius, useColor ? randomColor() : 'grey', useGradient));
			}

			if(animate){
				animateLine(drawings, 0);
			}
			else{
				for(let i = 0; i < drawings.length; i++){
					drawings[i]();
				}
				document.getElementById('drawBtn').removeAttribute('style');
				document.getElementById('stopDrawingBtn').setAttribute('style','display:none');
			}
		}
		
		function animateLine(allActions, index){
			if(index < allActions.length){
				allActions[index]();
				animationID = window.requestAnimationFrame(() => {
					animateLine(allActions, index + 1);
				});
			}
			else{
				document.getElementById('drawBtn').removeAttribute('style');
				document.getElementById('stopDrawingBtn').setAttribute('style','display:none');
			}
		}
		
		function gaussianPoint(mean, stdDev){
			const sq = Math.sqrt(-2 * Math.log(1 - Math.random()));
			const u2 = (1 - Math.random()) * 2 * Math.PI;
			const randStdNormalX = sq * Math.sin(u2);
			const randStdNormalY = sq * Math.cos(u2);
			const x = mean + stdDev * randStdNormalX;
			const y = mean + stdDev * randStdNormalY;
			return {x:x, y:y};
		}
		
		function drawCircle(ctx, center, radius, color, useGradient){
			if(useGradient){
				radius *= 1.5;
				const grad = ctx.createRadialGradient(center.x, center.y, 0, center.x, center.y, radius);
				grad.addColorStop(0, color);
				grad.addColorStop(1, 'transparent');
				ctx.fillStyle = grad;
			}
			else{
				ctx.fillStyle = color;
			}
			
			ctx.beginPath();
			ctx.arc(center.x, center.y, radius, 0, 2 * Math.PI);
			ctx.fill();
		}
		
		window.addEventListener('DOMContentLoaded', () => {
			document.getElementById('drawBtn').addEventListener('click', drawPattern);
			document.getElementById('stopDrawingBtn').addEventListener('click', () => {
				cancelAnimationFrame(animationID);
				document.getElementById('stopDrawingBtn').setAttribute('style','display:none');
				document.getElementById('drawBtn').removeAttribute('style');
			});
		});
	</script>
	<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico" />
</head>
<body>
<div class="navHolder">
	<nav>
		<a href="../index.html">Home</a>
		<a class="selected" href="../ramblings.html">Deranged Ramblings</a>
		<a href="../about.html">About</a>
	</nav>
</div>

<main>
	<div class="pageWidth">
		<header>
			<h1>Gauss</h1>
		</header>
		<section>
			<input id="animateInput" type="checkbox" checked>
			<label for="animateInput">Animate</label>
			<br>
			<input id="colorInput" type="checkbox" checked>
			<label for="colorInput">Use color</label>
			<br>
			<input id="gradInput" type="checkbox" checked>
			<label for="gradInput">Use Gradient</label>
			<br>
			<button id="drawBtn">Draw!</button>
			<button id="stopDrawingBtn" style="display:none">STOP</button>

			<div id="sizeCalc"></div>
			<img id="modMulResult">
			<div id="canvResult"></div>
		</section>
		<div class="scrollOverflow"></div>
	</div>
</main>
</body>
</html>