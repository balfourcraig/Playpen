<!DOCTYPE html>
<html lang="en-nz">
<head>
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta charset="UTF-8">
	<title>Seed of Life - Craig's Playpen</title>
	<link rel="stylesheet" href="../css/styles.css">
	<script>
		function randomColor() {
		  var letters = '0123456789ABCDEF';
		  var color = '#';
		  for (var i = 0; i < 6; i++) {
			color += letters[Math.floor(Math.random() * 16)];
		  }
		  return color;
		}
		
		let w;
		let h;
		
		function setUpConstants(){
			const sizeCalc = document.getElementById('sizeCalc');
			
			w = sizeCalc.getBoundingClientRect().width;
			h = w;
			sizeCalc.parentElement.removeChild(sizeCalc);
		}

		function setUpFast(){
			const colors = [];
			for(let i = 0; i < 6; i++){
				colors.push(randomColor());
			}
		
			const c = document.createElement('canvas');
			
			const ctx = c.getContext('2d');

			c.setAttribute('width', w);
			c.setAttribute('height', h);
			
			
			
			const center = {x: w/2.0, y: h/2.0};
			const radius = Math.min(w,h) / (Math.random() * 10 + 8);
			
			ctx.strokeStyle = '#000000';
			
			ctx.fillStyle = 'black';
			ctx.beginPath();
			ctx.rect(0, 0, w, h);
			ctx.fill();
			
			const grad = ctx.createRadialGradient(center.x, center.y,10, center.x, center.y, radius *0.9);
			grad.addColorStop(0, colors[1]);
			grad.addColorStop(1, colors[0]);
			ctx.fillStyle = grad;
			
			ctx.globalCompositeOperation = 'xor';
			ctx.beginPath();
			ctx.arc(center.x, center.y, radius, 0, 2 * Math.PI);
			ctx.closePath();

			ctx.fill();
			const layers = Math.floor(Math.random() * 4 + 3);
			for(let i = 1; i <= layers; i++){
				const layerPoints = subdividedHexagonAboutPoint(center, radius * i, i);
				for(let j = 0; j < layerPoints.length; j++){
					const p = layerPoints[j];
					
					const grad = ctx.createRadialGradient(p.x,p.y,10, p.x, p.y, radius *0.9);
					
					grad.addColorStop(0, colors[(i + 2) % colors.length]);
					grad.addColorStop(1, colors[(i+1) % colors.length]);
					ctx.fillStyle = grad;
					
					ctx.beginPath();
					ctx.arc(p.x, p.y, radius, 0, 2 * Math.PI);
					ctx.fill();
				}
				
			}
			
			ctx.globalCompositeOperation = 'difference';
			ctx.fillStyle = 'black';
			ctx.beginPath();
			ctx.rect(0, 0, w, h);
			ctx.fill();
			
			const canvResult = document.getElementById('canvResult');
			canvResult.innerHTML = '';
			canvResult.appendChild(c);
		}

		const seedAngle = Math.PI / 3;

		function subdividedHexagonAboutPoint(center, radius, subdivisions){
			const pointCenters = [];
			let prevPoint = null;
			for(let i = 0; i < 7; i++){
				const x = Math.sin(seedAngle * i) * radius + center.x;
				const y = Math.cos(seedAngle * i) * radius + center.y;
				
				const point = {x: x, y: y};
				if(prevPoint){
					pointCenters.push(point);
					if(subdivisions > 0){
						const xDist = (x - prevPoint.x) / subdivisions;
						const yDist = (y - prevPoint.y) / subdivisions;
						
						for(let sub = 1; sub < subdivisions; sub++){
							subPoint = {x: x - xDist * sub, y: y - yDist * sub};
							pointCenters.push(subPoint);
						}
					}
				}
				prevPoint = point;
			}
			return pointCenters;
		}
	
		window.addEventListener('DOMContentLoaded', () => {
			setUpConstants();
			setUpFast();			
		});
	</script>
	<link rel="shortcut icon" type="image/x-icon" href="../favicon.ico" />
</head>
<body>
<div class="navHolder">
	<nav>
		<a href="../index.html">Home</a>
		<a class="selected" href="../ramblings.html">Deranged Ramblings</a>
		<a href="../about.html">About</a>
	</nav>
</div>

<main>
	<div class="pageWidth">
		<header>
			<h1>Seed of Life</h1>
		</header>
		<section>
			<p>"Seed of Life" pattern drawn on an HTML5 canvas, without re-drawing any lines</p>
			<p>Refresh the page to redraw with different random colors and scales</p>
			<div id="sizeCalc">Placeholder while the image builds. If you see this, your computer is either very slow, you're using a shit browser (looking at you, Internet Explorer!), or my site has died.</div>
			<div id="canvResult"></div>
		</section>
		<div class="scrollOverflow"></div>
	</div>
</main>
</body>
</html>